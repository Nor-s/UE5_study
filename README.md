# **CH5 폰의 제작과 조작**

- 폰 = 움직이는 액터 + 조종당하는 기능
- 폰을 직접 조작 (입력 설정)
  - 폰 무브먼트 컴포넌트
  - 애니메이션 블프 사용

## **폰의 구성요소**

- 시각적 요소
  - 인간형 폰: 애니메이션 기능 필요
  - 스케레탈 메시: 리깅 데이터 추가됨 (관리하는 컴포넌트: 스켈레탈 메시 컴포넌트)

- 충돌요소
  - 인간형은 보통 캡츌 컴포넌트 사용
- 움직임 요소
  - 폰 무브먼트 컴포넌트 
  - FloatingPawnMovement, CharacterMovement
- 내비게이션
  - 폰은 언리얼 엔진의 내비게이션 시스템과 연동됨, 길찾기 기능 가짐

- 카메라 출력
  - 이동과 동시에 모니터에 장면을 출력해야함
  - 폰에 카메라 컴포넌트를 부착하면, 플레이어 컨트롤러가 폰에 빙의할 때 자동으로 폰에 부착된 카메라를 모니터에 출력


## **스케레탈 메시 에셋 사용**

### **사용한 컴포넌트**

- **Capsule**
  - 충돌 컴포넌트
  - 폰을 대표해 게임 월드의 움직임을 담당, 루트 컴포넌트로
- **SkeletalMesh**
  - 캐릭터 애셋을 보여주고, 추가로 애니메이션도 담당
  - 모델 제작 소포트웨어와 언리얼 엔진의 3차원 좌표계가 서로 다를 수 있음
    - z축-90도 회전 
  - 언리얼 액터의 기준 위치는 정중앙 위치인 반면, 보통 캐릭터 애셋은 발바닥 기준(pivot)
    - z축 절반정도 내려줌
- **FloatingPawnMovement**
  - 중력을 고려하지 않은 간단한 움직임 구현
- **SpringArm**
  - 삼인칭 시점으로 카메라 구도를 편리하게 설정할 수 있는 부가 컴포넌트
- **Camera**
  - 삼인칭 시점
    - 카메라 컴포넌트를 스프링암 컴포넌트의 자식으로 설정
    - 트랜스폼 정보를 초기화하면 카메라는 자동으로 스프링암의 끝에 걸림

### **폰의 조작**

- project settings > input > Action Mappings, Axis Mappings

- Axis Mappings
  - 조이스틱 레버의 신호를 설정하는 곳
    - 레버의 위치가 끝: 설정된 스케일에 따라 1 or -1
    - 레버의 위치가 중립: 0
    
- Action Mappings
  - 조이스틱 버튼의 신호를 설정하는 곳
    - 누르거나 뗄 때만 신호 전달
      - 버튼을 누르면 1, 떼면 0 

- `InputComponent` 사용 
  - `SetupInputComponent`: 폰의 멤버 함수와 입력 설정을 연결(바인딩)
  - 입력 신호는 자동으로 폰의 멤버 함수의 인자로 전달

- AddMovementInput
  - Scale: 세기, 1(전진), -1(후진)
  - WorldDirection에 방향 지정
    - GetActorForwardVector 등 함수로 방향 지정
    
- **입력 로직**
  - 폰 클래스에 구현하는 것이 일반적
  - UE의 입력 시스템은 플레이어 컨트롤러를 거쳐서 폰에 전달됨
  - **컨트롤러에 특정 입력을 처리하는 코드를 구현하면, 해당 입력은 플레이어 컨트롤러에서 필터링되어 폰에 전달되지 않음**
  
- 플레이어 컨트롤러 (화면에 관련된 인터페이스 기능)
  - 플레이어의 입력과 출력되는 화면을 책임짐
  - UI를 배제하고, 게임에게만 입력을 전달하도록 명령을 내리면, 쉽게 테스트 가능
  - `FInputModeGameOnly`, `SetInputMode()`

### **애니메이션 설정**

- 게임 규모가 커지면 코드로 애니메이션 시스템을 구현하는 것 보다 애니메이션 블루프린트를 활용하는 것이 더 좋음
  - EAnimationMode::AnimationSingleNode => EAnimationMode::AnimationBlueprint
- 애니메이션 블루프린트는 애님 그래프 로직에 따라 동작하는 캐릭터 애니메이션 시스템을 구동시킴
  - 이러한 애니메이션 시스템은 C++ 프로그래밍의 애님 인스턴스라는 클래스로 관리됨
  - 스케레탈 메시 컴포넌트는 캐릭터의 애니메이션을 이 애님 인스턴스에 위임하는 구조로 설계되어 있음
  - 스케레탈 메시가 애니메이션 블프를 실행시키려면, 블프 애셋의 클래스 정보를 애님 인스턴스 속성에 지정해줘야함
  - 지정하면, 컴포넌트는 인스턴스를 생성해 애니메이션을 관리함.



